import{b as V,e as A,g as N}from"./chunk-6UKTLYYS.js";import{$a as d,Cb as B,Da as F,Fb as L,Gb as U,Lb as R,N as _,Oa as b,Ob as S,Pa as u,Qa as x,Ra as g,S as y,Sa as f,T as D,Ta as n,Ua as r,Va as v,Wa as k,Xa as w,Ya as c,_a as T,ab as m,bb as P,gb as M,hb as I,kb as C,lb as h,oa as $,qa as a,qb as O}from"./chunk-362EEDBT.js";var j=(i,t)=>t.dateStr,H=(i,t)=>t.slotId;function K(i,t){if(i&1){let e=k();n(0,"li",21)(1,"button",24),w("click",function(){let l=y(e).$index,s=c(3);return D(s.selectedTabIndex=l)}),n(2,"div",13),d(3),C(4,"date"),r(),n(5,"div"),d(6),C(7,"date"),r()()()}if(i&2){let e=t.$implicit,o=t.$index,l=c(3);a(),T("active",o===l.selectedTabIndex),f("id",I("tab-",o)),a(2),m(h(4,6,e.displayDate,"EEE")),a(3),m(h(7,9,e.displayDate,"MMM d"))}}function W(i,t){if(i&1){let e=k();n(0,"div",27)(1,"button",28),w("click",function(){let l=y(e).$implicit,s=c(4);return D(s.bookSlot(l))}),d(2),C(3,"date"),r()()}if(i&2){let e=t.$implicit;a(),f("ngClass",e.isBooked?"btn-light text-muted border-0":"btn-outline-primary fw-semibold")("disabled",e.isBooked),a(),P(" ",h(3,3,e.startUTC,"HH:mm")," ")}}function Y(i,t){if(i&1&&(n(0,"div",25)(1,"div",26),x(2,W,4,6,"div",27,H),r()()),i&2){let e=t.$implicit,o=t.$index,l=c(3);T("show",o===l.selectedTabIndex)("active",o===l.selectedTabIndex),a(2),g(e.slots)}}function q(i,t){if(i&1&&(n(0,"ul",20),x(1,K,8,12,"li",21,j),r(),n(3,"div",22),x(4,Y,4,4,"div",23,j),r()),i&2){let e=c(2);a(),g(e.groupedSlots),a(3),g(e.groupedSlots)}}function G(i,t){i&1&&(n(0,"div",29),d(1," No availability found for the next 7 days. "),r())}function J(i,t){if(i&1&&b(0,G,2,0,"div",29),i&2){let e=c(2);u(e.isLoading?-1:0)}}function Q(i,t){if(i&1&&(n(0,"div",2)(1,"div",3)(2,"div",4),v(3,"img",5),r(),n(4,"div",6)(5,"div",7)(6,"a",8),v(7,"i",9),d(8," Back "),r(),n(9,"h2",10),d(10),r(),n(11,"div",11)(12,"span",12),d(13),r(),n(14,"span",13),d(15),r()(),n(16,"p",14),d(17),r()()(),n(18,"div",15)(19,"p",16),d(20),r()()()(),n(21,"h5",17),d(22,"Select Appointment Time"),r(),n(23,"p",18),v(24,"i",19),d(25," Times shown in your local timezone."),r(),b(26,q,6,0)(27,J,1,1)),i&2){let e=c();a(3),f("src",I("https://placehold.co/250x250/e9ecef/adb5bd?text=",e.getInitials(e.provider.name)),$)("alt",M(e.provider.name)),a(7),m(e.provider.name),a(3),m(e.provider.specialty),a(2),P("$",e.provider.hourlyRateUSD,"/hr"),a(2),m(e.provider.description),a(3),m(e.provider.description),a(6),u(e.groupedSlots.length>0?26:27)}}function X(i,t){i&1&&(n(0,"div",1),v(1,"div",30),n(2,"p",31),d(3,"Loading provider details..."),r()())}var z=class i{provider=null;slots=[];isLoading=!1;groupedSlots=[];selectedTabIndex=0;error="";route=_(V);http=_(R);cdr=_(O);ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("id");e?(console.log("Target Provider ID:",e),this.provider=null,this.groupedSlots=[],this.loadProviderDetails(e),this.loadSlots(e)):this.error="No provider ID found in route"})}loadProviderDetails(t){let e=`${S.apiUrl}/providers/${t}`;console.log("Fetching provider from:",e),this.http.get(e).subscribe({next:o=>{console.log("Provider Data Received:",o),this.provider=o,this.error="",this.cdr.markForCheck()},error:o=>{console.error("Provider API Error:",o),this.error=`Failed to load provider: ${o.status} ${o.statusText}`,this.cdr.markForCheck()}})}loadSlots(t){this.isLoading=!0;let e=new Date,o=new Date;o.setDate(e.getDate()+7);let l=e.toISOString().split("T")[0],s=o.toISOString().split("T")[0],E=`${S.apiUrl}/availability/${t}/slots?SeekerTimezoneId=America/New_York`;console.log("Fetching slots from:",E),this.http.get(E).subscribe({next:p=>{console.log("Slots Received:",p),this.slots=p,this.groupSlotsByDay(p),this.isLoading=!1,this.cdr.detectChanges(),this.cdr.markForCheck()},error:p=>{console.error("Slots API Error:",p),this.error=`Failed to load slots: ${p.status} ${p.statusText}`,this.isLoading=!1,this.cdr.markForCheck()}})}bookSlot(t){this.http.post(`${S.apiUrl}/bookings`,{slotId:t.slotId,paymentToken:"tok_visa_success_9988"}).subscribe({next:()=>{alert("Booked successfully!"),window.location.reload()},error:e=>alert(e.error?.message||"Error booking slot")})}groupSlotsByDay(t){let e=new Map;for(let o of t){let l=new Date(o.startUTC),s=l.toLocaleDateString();e.has(s)||e.set(s,{dateStr:s,displayDate:l,slots:[]}),e.get(s).slots.push(o)}this.groupedSlots=Array.from(e.values()).sort((o,l)=>o.displayDate.getTime()-l.displayDate.getTime()),this.groupedSlots.length>0&&(this.selectedTabIndex=0)}getInitials(t){return t?t.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"PV"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-provider-detail"]],decls:3,vars:1,consts:[[1,"container","mt-4","pb-5"],[1,"container","text-center","py-5","mt-5"],[1,"card","border-0","shadow-sm","mb-4","animate-fade-in","overflow-hidden"],[1,"row","g-0"],[1,"col-md-3","col-4","bg-light","d-flex","align-items-center","justify-content-center","p-3"],[1,"img-fluid","rounded-circle","shadow-sm","border",2,"width","120px","height","120px","object-fit","cover",3,"src","alt"],[1,"col-md-9","col-8"],[1,"card-body","py-3"],["routerLink","/search",1,"text-decoration-none","text-muted","small","mb-2","d-inline-block"],[1,"bi","bi-arrow-left"],[1,"fw-bold","mb-1"],[1,"mb-3"],[1,"badge","bg-primary","me-2"],[1,"fw-bold"],[1,"text-muted","small","d-none","d-md-block"],[1,"col-12","d-md-none","px-3","pb-3"],[1,"text-muted","small","mb-0"],[1,"mb-3","fw-bold"],[1,"text-muted","small"],[1,"bi","bi-clock"],["id","slotTabs","role","tablist",1,"nav","nav-tabs","nav-fill","mb-3","flex-nowrap","overflow-auto","pb-1"],["role","presentation",1,"nav-item"],["id","slotTabsContent",1,"tab-content"],["role","tabpanel",1,"tab-pane","fade",3,"show","active"],["type","button","role","tab",1,"nav-link","text-nowrap","px-3","py-2","small",3,"click","id"],["role","tabpanel",1,"tab-pane","fade"],[1,"row","g-2"],[1,"col-4","col-sm-3","col-md-2"],[1,"btn","w-100","py-2",3,"click","ngClass","disabled"],[1,"alert","alert-info"],["role","status",1,"spinner-border","text-primary","mb-3",2,"width","3rem","height","3rem"],[1,"text-muted"]],template:function(e,o){e&1&&(n(0,"div",0),b(1,Q,28,10)(2,X,4,0,"div",1),r()),e&2&&(a(),u(o.provider?1:2))},dependencies:[U,B,N,A,L],styles:[".nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{border-bottom-width:3px;border-radius:0;color:#6c757d}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#0d6efd;border-bottom-color:#0d6efd;background:transparent}.overflow-auto[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.overflow-auto[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}"]})};export{z as ProviderDetailComponent};
